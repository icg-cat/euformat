---
title: "Using the euformat Package"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Using the euformat Package}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

The euformat package provides a lightweight way to:

- store numbers as real numeric values,  
- but print them using European number formatting:  
  - comma for decimals  
  - dot for thousands  
  - optional euro currency symbol (" â‚¬")

Formatted numbers behave exactly like numeric* in calculations; only printing changes.

The package works consistently in:

- R console  
- base data.frames  
- tibbles  
- DT tables  

and includes a global toggle to enable/disable printing.

```{r}
library(ggplot2)
library(tibble)
library(DT)
library(euformat)
```


## Basic usage

### Create EU-formatted numbers

```{r}
x <- eu_num(c(1234.567, 10.2))
x
```

Internally still numeric:

```{r}
is.numeric(x)
x + 1
```


## Currency formatting

```{r}
eu_currency(c(1500, 20000))
```


## Vectorized decimal digits

```{r}
eu_num(c(1.2345, 2.34567), digits = c(1, 3))
```


## Using euformat inside tibbles

```{r}
tibble(value = eu_num(c(1234.5, 98765.432)))
```


## Using euformat in base data frames

```{r}
data.frame(amount = eu_currency(c(1234.5, 98765.4)))
```


## Formatting in DT tables

```{r}
df <- cbind(
  item  = c("A", "B", "C", "D"),
  value = c(2, 10, 1000.5, 12.34), 
  cost  = (c(2, 10, 1000.5, 12.34) * 1.3)
)

datatable(df) |>
  dt_format_eu(columns = c("value", "cost"), digits = 2, currency = TRUE)

```

Numeric format is maintained, so further developments can be added to the table: 
```{r}
datatable(
  df,
  container = htmltools::withTags(
    table(
      tableHeader(df),
      tableFooter(c("Total", "", ""))  # footer placeholders
    )
  ),
  options = list(
    footerCallback = JS(
      "function(tfoot, data, start, end, display) {",
      "  var api = this.api();",

      "  // numeric totals for value and cost",
      "  var total_value = api.column(1, { page: 'current' }).data().reduce(function(a,b){",
      "    return a + parseFloat(b) || 0;",
      "  }, 0);",

      "  var total_cost = api.column(2, { page: 'current' }).data().reduce(function(a,b){",
      "    return a + parseFloat(b) || 0;",
      "  }, 0);",

      "  // write totals into footer",
      "  $(api.column(0).footer()).html('Total');",
      "  $(api.column(1).footer()).html(total_value);",
      "  $(api.column(2).footer()).html(total_cost);",
      "}"
    )
  )
) |> dt_format_eu(columns = c("value", "cost"), digits = 2, currency = TRUE)
```


```{r eval=FALSE, include=FALSE}

df <- data.frame(
  item  = c("A", "B", "C", "D"),
  value = c(2, 10, 1000.5, 12.34),
  cost  = c(2, 10, 1000.5, 12.34) * 1.3
)

# compute totals in R
total_row <- data.frame(
  item  = "Total",
  value = sum(df$value),
  cost  = sum(df$cost)
)

df2 <- rbind(df, total_row)

datatable(df2)|> 
  dt_format_eu(columns = c("value", "cost"), digits = 2, currency = TRUE)


```


## Formatting in ggplot2
```{r ggplot-example, message=FALSE, warning=FALSE}

# Example data
df <- data.frame(
  category = LETTERS[1:5],
  revenue  = c(1234.5, 56789, 101112.3, 2000, 300.75)
)

# Plain EU number formatting
p1 <- ggplot(df, aes(category, revenue)) +
  geom_col(fill = "#4477AA") +
  eu_scale_y() +
  ggtitle("Revenue with EU-style number formatting")

# EU currency formatting
p2 <- ggplot(df, aes(category, revenue)) +
  geom_col(fill = "#66CCAA") +
  eu_scale_y(currency = TRUE) +
  ggtitle("Revenue with EU-style currency formatting")

p1
p2
```

## Turning formatting on and off
```{r}
eu_format_off()
x
```


```{r}
eu_format_on()
x
```

This affects printing only; underlying data remain numeric.

